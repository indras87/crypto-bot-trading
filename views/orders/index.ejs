<!-- Content -->
<div class="p-3 md:p-4">
    <div class="max-w-[900px] mx-auto">
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 mb-4">
            <h1 class="text-xl md:text-2xl font-semibold">Orders</h1>
            <nav class="text-[13px] text-gray-500">
                <a href="/" class="text-blue-600 hover:underline">Dashboard</a> / Orders
            </nav>
        </div>

        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
            <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded mb-4">
                <div class="font-medium mb-2"><i class="fas fa-triangle-exclamation"></i> Errors loading pairs:</div>
                <ul class="text-sm list-disc list-inside">
                    <% errors.forEach(function(err) { %>
                        <li><%= err %></li>
                    <% }); %>
                </ul>
            </div>
        <% } %>

        <div class="flex gap-4">
            <!-- Pairs list -->
            <div class="flex-1 bg-white border border-gray-200 rounded">
                <div class="px-4 py-3 border-b border-gray-200 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2">
                    <span class="font-medium">Profile:Pairs (<%= allPairs.length %>)</span>
                    <input type="text" id="pair-filter" placeholder="Filter..." class="border border-gray-300 rounded px-3 py-2 text-sm w-full sm:w-48">
                </div>
                <div id="pairs-list" class="max-h-[60vh] md:max-h-[calc(100vh-280px)] overflow-y-auto">
                    <% if (allPairs && allPairs.length > 0) { %>
                            <div class="overflow-x-auto">
                            <table class="w-full border-collapse text-[13px]">
                            <thead class="sticky top-0 bg-gray-50">
                                <tr>
                                    <th class="border border-gray-200 font-semibold px-3 py-2 text-left">Profile:Pair</th>
                                    <th class="border border-gray-200 font-semibold px-3 py-2 text-center">Type</th>
                                </tr>
                            </thead>
                            <tbody>
                            <% allPairs.forEach(function(item) { %>
                                <tr class="pair-item hover:bg-gray-100 cursor-pointer"
                                    data-search="<%= item.profileName.toLowerCase() %> <%= item.pair.toLowerCase() %>"
                                    onclick="window.location.href='/orders/<%= item.profileId %>/<%= encodeURIComponent(item.pair) %>'">
                                    <td class="border border-gray-200 px-3 py-3 md:py-2 whitespace-nowrap">
                                        <span class="text-gray-500"><%= item.profileName %>:</span><%= item.pair %>
                                    </td>
                                    <td class="border border-gray-200 px-3 py-3 md:py-2 text-center">
                                        <%- getTypeBadge(item.type) %>
                                    </td>
                                </tr>
                            <% }); %>
                            </tbody>
                        </table>
                        </div>
                    <% } else { %>
                        <div class="px-4 py-8 text-center text-gray-500">
                            <i class="fas fa-circle-exclamation text-4xl mb-3 text-gray-300"></i>
                            <p>No pairs found.</p>
                            <a href="/profiles" class="text-blue-600 hover:underline">Configure profiles</a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<% function getTypeBadge(type) { %>
    <% if (type === 'spot') { %>
        <span class="bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded text-xs">Spot</span>
    <% } else if (type === 'margin') { %>
        <span class="bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded text-xs">Margin</span>
    <% } else if (type === 'swap' || type === 'future_perp') { %>
        <span class="bg-orange-100 text-orange-700 px-1.5 py-0.5 rounded text-xs">Future (Perp)</span>
    <% } else if (type === 'future' || type === 'future_dated') { %>
        <span class="bg-green-100 text-green-700 px-1.5 py-0.5 rounded text-xs">Future (Dated)</span>
    <% } else { %>
        <span class="text-gray-400">-</span>
    <% } %>
<% } %>

<script>
    // Filter functionality
    document.getElementById('pair-filter')?.addEventListener('input', function(e) {
        const filter = e.target.value.toLowerCase();
        document.querySelectorAll('.pair-item').forEach(function(item) {
            const search = item.getAttribute('data-search') || '';
            item.style.display = search.includes(filter) ? '' : 'none';
        });
    });
</script>
