<!-- Content -->
<div class="p-4">
    <div class="max-w-[1800px] mx-auto">
        <div class="flex items-center justify-between mb-4">
            <h1 class="text-2xl font-semibold">Trades</h1>
            <div class="flex items-center gap-4">
                <form method="get" action="/trades">
                    <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-sm">
                        <i class="fas fa-sync-alt mr-1"></i> Reload
                    </button>
                </form>
                <nav class="text-sm text-gray-500">
                    <a href="/" class="text-blue-600 hover:underline">Dashboard</a> / Trades
                </nav>
            </div>
        </div>

        <!-- Positions Table -->
        <div class="bg-white overflow-x-auto mb-4">
            <div class="px-4 py-3 border-b-2 border-gray-300 flex justify-between items-center">
                <span class="text-lg font-semibold">Positions</span>
                <span class="text-gray-500 text-[13px]"><%= updatedAt %></span>
            </div>

            <table class="w-full border-collapse text-[13px]">
                <thead>
                <tr>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2" title="Exchange">E</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Symbol</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Amount</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Currency</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Profit</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Entry</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Updated</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Created</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2" title="Side">S</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2" title="Action">A</th>
                </tr>
                </thead>
                <tbody>
                <% positions.forEach(function(item) { %>
                <tr class="hover:bg-gray-100">
                    <td class="border border-gray-200 px-3 py-2">
                        <img src="/img/exchanges/<%= item.exchange %>.png" alt="<%= item.exchange %>" title="<%= item.exchange %>" width="16" height="16">
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <a target="_blank" href="/tradingview/<%= item.exchange %>:<%= encodeURIComponent(item.position.symbol) %>" class="text-blue-600 hover:underline"><%= item.position.symbol %></a>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 <%= item.position.amount > 0 ? 'text-green-600' : (item.position.amount < 0 ? 'text-red-600' : '') %>">
                        <%= item.position.amount %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (item.currency) { %>
                            <%= item.currency < 1 ? item.currency.toFixed(6) : item.currency.toFixed(2) %>
                            <% if (item.currencyProfit) { %>
                                <span class="text-gray-500"> / <%= item.currencyProfit < 1 ? item.currencyProfit.toFixed(6) : item.currencyProfit.toFixed(2) %></span>
                            <% } %>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (typeof item.position.profit !== 'undefined') { %>
                            <span class="<%= item.position.profit >= 0 ? 'text-green-600' : 'text-red-600' %>">
                                <%= item.position.profit.toFixed(2) %> %
                            </span>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (item.position.entry) { %>
                            <%= item.position.entry < 1 ? item.position.entry.toFixed(6) : item.position.entry.toFixed(2) %>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (item.position.updatedAt) { %>
                            <%= new Date(item.position.updatedAt).toLocaleString() %>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (item.position.createdAt) { %>
                            <%= new Date(item.position.createdAt).toLocaleString() %>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <% if (item.position.side === 'short') { %>
                            <i class="fas fa-chevron-circle-down text-red-600" title="short"></i>
                        <% } else if (item.position.side === 'long') { %>
                            <i class="fas fa-chevron-circle-up text-green-600" title="long"></i>
                        <% } %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 p-0">
                        <form action="/pairs/<%= item.exchange %>-<%= item.position.symbol %>" method="post">
                            <button class="text-gray-600 hover:text-red-600 px-1 py-1" name="action" value="close" title="Limit Close">
                                <i class="fas fa-window-close" style="font-size: 0.9rem"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                <% }); %>
                </tbody>
            </table>
        </div>

        <!-- Orders Table -->
        <div class="bg-white overflow-x-auto">
            <div class="px-4 py-3 border-b-2 border-gray-300 flex justify-between items-center">
                <span class="text-lg font-semibold">Open Orders (<%= openOrders.length %>)</span>
                <span class="text-gray-500 text-[13px]"><%= updatedAt %></span>
            </div>

            <% if (openOrders.length > 0) { %>
            <table class="w-full border-collapse text-[13px]">
                <thead>
                <tr>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Profile</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Symbol</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Side</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Type</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Price</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Amount</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Filled</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Status</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2">Date</th>
                    <th class="border border-gray-200 bg-gray-50 font-semibold px-3 py-2" title="Action">A</th>
                </tr>
                </thead>
                <tbody>
                <% openOrders.forEach(function(item) { %>
                <tr class="hover:bg-gray-100">
                    <td class="border border-gray-200 px-3 py-2">
                        <span class="text-gray-600"><%= item.profileName %></span>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 font-mono">
                        <%= item.order.pair %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <span class="px-2 py-0.5 rounded text-xs <%= item.order.side === 'buy' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' %>">
                            <%= item.order.side %>
                        </span>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <span class="px-2 py-0.5 rounded text-xs bg-gray-100 text-gray-700">
                            <%= item.order.type %>
                        </span>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 font-mono text-right">
                        <%= item.order.price < 0.01 ? item.order.price.toFixed(8) : item.order.price.toFixed(2) %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 font-mono text-right">
                        <%= item.order.amount.toFixed(6) %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 font-mono text-right text-gray-500">
                        <%= item.order.filled.toFixed(6) %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <span class="px-2 py-0.5 rounded text-xs bg-blue-100 text-blue-800">
                            <%= item.order.status %>
                        </span>
                    </td>
                    <td class="border border-gray-200 px-3 py-2 text-gray-500">
                        <%= item.order.timestamp ? new Date(item.order.timestamp).toLocaleString() : '-' %>
                    </td>
                    <td class="border border-gray-200 px-3 py-2">
                        <a title="cancel" href="/order/<%= item.profileId %>/<%= encodeURIComponent(item.order.pair) %>/<%= item.order.id %>" class="text-gray-600 hover:text-red-600"><i class="fas fa-window-close"></i></a>
                    </td>
                </tr>
                <% }); %>
                </tbody>
            </table>
            <% } else { %>
            <div class="p-4 text-center text-gray-400">No open orders</div>
            <% } %>
        </div>
    </div>
</div>
